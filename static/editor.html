<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync | Editor</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Profile Modal -->
    <div id="profile-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center;">
        <div class="card"
            style="width: 450px; padding: 32px; background: white; border-radius: 12px; box-shadow: var(--shadow-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-weight: 800;">Profile Settings</h2>
                <button id="close-profile-modal"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px; gap: 16px;">
                <div style="position: relative;">
                    <img id="settings-avatar-preview" src="" class="avatar"
                        style="width: 100px; height: 100px; margin-left: 0; border: 4px solid white; box-shadow: var(--shadow-md);">
                    <label for="avatar-input"
                        style="position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid white;">
                        <span style="font-size: 1rem;">üì∑</span>
                    </label>
                    <input type="file" id="avatar-input" accept="image/*" style="display: none;">
                </div>
                <div style="text-align: center;">
                    <p style="font-size: 0.8rem; color: var(--text-muted);">Click the camera icon to upload a new
                        photo.<br>Supports JPG, PNG, or WebP.</p>
                </div>
            </div>

            <div class="input-group">
                <label>Username</label>
                <input type="text" id="settings-username" placeholder="Enter new username">
            </div>

            <div class="input-group">
                <label>Email (Read-only)</label>
                <input type="text" id="settings-email" disabled style="background: #f1f5f9; cursor: not-allowed;">
            </div>

            <div style="display: flex; gap: 12px; margin-top: 12px;">
                <button class="btn btn-primary" id="save-profile" style="flex: 1;">Save Changes</button>
            </div>
        </div>
    </div>
    <div class="editor-container">
        <header class="editor-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <a href="/static/dashboard.html"
                    style="text-decoration: none; color: var(--text-muted); font-size: 1.2rem; margin-right: 8px;">‚Üê</a>
                <h2 id="doc-title" contenteditable="true"
                    style="font-weight: 800; border-bottom: 2px solid transparent;">
                    Loading...</h2>
            </div>

            <div style="display: flex; gap: 24px; align-items: center;">
                <div id="user-profile"
                    style="display: flex; align-items: center; gap: 10px; padding-right: 16px; border-right: 1px solid var(--border);">
                    <img id="user-avatar" src="" alt="" class="avatar"
                        style="margin-left: 0; cursor: default; width: 28px; height: 28px;">
                    <div style="line-height: 1.1;">
                        <div id="user-name" style="font-weight: 700; font-size: 0.8rem;"></div>
                        <div id="user-email" style="font-size: 0.7rem; color: var(--text-muted);"></div>
                    </div>
                </div>
                <!-- Presence Bar -->
                <div class="presence-bar" id="presence-bar">
                    <!-- Avatars injected here -->
                </div>

                <div style="display: flex; align-items: center; gap: 8px;">
                    <div id="sync-status" style="width: 8px; height: 8px; border-radius: 50%; background: #94a3b8;">
                    </div>
                    <span id="sync-text"
                        style="font-size: 0.75rem; font-weight: 600; color: var(--text-muted);">Syncing...</span>
                </div>
                <button class="btn btn-primary" style="padding: 6px 16px; font-size: 0.85rem;"
                    id="share-btn">Share</button>
            </div>
        </header>

        <main style="flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative;">
            <textarea id="editor-textarea" placeholder="Start writing..."></textarea>
            <!-- Remote cursors overlay -->
            <div id="cursors-layer"
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden;">
            </div>
        </main>
    </div>

    <!-- Share Modal -->
    <div id="share-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center;">
        <div class="card" style="width: 500px; max-height: 90vh; display: flex; flex-direction: column;">
            <h3 style="margin-bottom: 20px;">Manage Collaborators</h3>

            <div style="display: flex; gap: 10px; margin-bottom: 24px;">
                <input type="email" id="invite-email" placeholder="colleague@example.com"
                    style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
                <select id="invite-role" style="padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
                    <option value="viewer">Viewer</option>
                    <option value="editor">Editor</option>
                </select>
                <button class="btn btn-primary" id="add-collab-btn">Add</button>
            </div>

            <div style="flex: 1; overflow-y: auto;">
                <h4
                    style="font-size: 0.8rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 12px;">
                    Who has access</h4>
                <div id="collaborators-list">
                    <!-- Collaborators injected here -->
                </div>
            </div>

            <div
                style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end;">
                <button class="btn btn-outline" id="close-share-modal">Close</button>
            </div>
        </div>
    </div>

    <!-- Import Map for Yjs -->
    <script type="importmap">
        {
            "imports": {
                "yjs": "https://esm.sh/yjs@13.6.10",
                "y-protocols/awareness": "https://esm.sh/y-protocols@1.0.6/awareness"
            }
        }
    </script>
    <script type="module" src="/static/js/editor.js"></script>
</body>

</html>